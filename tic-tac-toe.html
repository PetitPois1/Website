<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tic-Tac-Toe Game</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #1e1e2f;
            font-family: Arial, sans-serif;
            overflow: hidden;
        }
        .score-board {
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 10px;
            font-size: 18px;
            color: #fff;
        }
        .board {
            display: grid;
            grid-template-columns: repeat(3, 100px);
            grid-template-rows: repeat(3, 100px);
            gap: 5px;
            margin-top: 20px;
        }
        .cell {
            width: 100px;
            height: 100px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 36px;
            background-color: #2a2a40;
            color: white;
            border: 2px solid #6200ea;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .cell:hover {
            background-color: #3700b3;
        }
        button {
            margin-top: 20px;
            padding: 10px 20px;
            font-size: 16px;
            color: white;
            background-color: #6200ea;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background-color: #3700b3;
        }
        select {
            padding: 5px;
            background-color: #3700b3;
            color: white;
            border: none;
            border-radius: 4px;
            margin-left: 10px;
        }
        select:focus {
            outline: none;
        }
        .turn-indicator {
            font-size: 20px;
            color: #fff;
            margin-top: 10px;
        }
        .fade-message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            font-size: 30px;
            padding: 20px;
            border-radius: 10px;
            display: none;
            opacity: 0;
            animation: fadeInOut 2s forwards;
        }
        @keyframes fadeInOut {
            0% { opacity: 0; }
            50% { opacity: 1; }
            100% { opacity: 0; }
        }
        .appear {
            display: block;
        }
    </style>
</head>
<body>
    <div class="score-board">
        <span id="x-score">X Score: 0</span>
        <span id="o-score">O Score: 0</span>
        <div>
            Difficulty:
            <select id="difficulty">
                <option value="coop">Coop (2 Player)</option>
                <option value="easy">Easy</option>
                <option value="medium" selected>Medium</option>
                <option value="hard">Hard</option>
            </select>
        </div>
    </div>
    <div class="turn-indicator" id="turn-indicator">Player X's Turn</div>
    <div class="board" id="board">
        <!-- Tic-Tac-Toe cells will go here -->
    </div>
    <div id="winner-message" class="fade-message"></div>
    <button onclick="window.location.href='index.html'">Back to Home</button>

    <script>
        const board = document.getElementById('board');
        const turnIndicator = document.getElementById('turn-indicator');
        const winnerMessage = document.getElementById('winner-message');
        let currentPlayer = 'X';
        let gameBoard = Array(9).fill(null);
        let xScore = 0;
        let oScore = 0;
        let currentMode = 'medium';
        let aiDifficulty = "Medium";
        let isGameOver = false;
        let isPlayerTurn = true; // Track if it's the player's turn or AI's
        let isGameInProgress = false; // Track if game is in progress to block clicks

        const difficultySelect = document.getElementById("difficulty");
        let difficulty = "medium"; // Default difficulty

        // AI Logic Placeholder Functions (Easy, Medium, Hard)
        function aiMove() {
            if (difficulty === 'coop') return; // Coop mode is for 2 players, no AI move needed
            if (isPlayerTurn || isGameOver) return; // Prevent AI from moving if it's player's turn or game over

            setTimeout(() => { // Simulate delay for AI move
                if (difficulty === 'easy') {
                    easyAI();
                } else if (difficulty === 'medium') {
                    mediumAI();
                } else if (difficulty === 'hard') {
                    hardAI();
                }
            }, 1000); // Delay of 1 second to make it feel more realistic
        }

        // Easy AI (Random Move)
        function easyAI() {
            const emptyCells = gameBoard.map((cell, index) => cell === null ? index : null).filter(cell => cell !== null);
            const randomCell = emptyCells[Math.floor(Math.random() * emptyCells.length)];
            gameBoard[randomCell] = 'O';
            currentPlayer = 'X';
            isPlayerTurn = true; // Allow player to move again
            renderBoard();
            checkForWinner();
        }

        // Medium AI (Blocks or Plays Random)
        function mediumAI() {
            // Check for blocking or winning move
            const winningMove = findWinningMove('O');
            if (winningMove !== -1) {
                gameBoard[winningMove] = 'O';
            } else {
                const blockMove = findWinningMove('X');
                if (blockMove !== -1) {
                    gameBoard[blockMove] = 'O';
                } else {
                    easyAI();
                }
            }
            currentPlayer = 'X';
            isPlayerTurn = true; // Allow player to move again
            renderBoard();
            checkForWinner();
        }

        // Hard AI (Minimax Algorithm for Optimal Move)
        function hardAI() {
            const bestMove = minimax(gameBoard, 'O');
            gameBoard[bestMove] = 'O';
            currentPlayer = 'X';
            isPlayerTurn = true; // Allow player to move again
            renderBoard();
            checkForWinner();
        }

        // Minimax Algorithm for Optimal Move (Hard AI)
        function minimax(board, player) {
            const availableMoves = board.map((cell, index) => cell === null ? index : null).filter(cell => cell !== null);
            const opponent = player === 'O' ? 'X' : 'O';
            
            if (checkWinner(board, 'O')) return 10;
            if (checkWinner(board, 'X')) return -10;
            if (availableMoves.length === 0) return 0;

            let bestScore = player === 'O' ? -Infinity : Infinity;
            let bestMove = null;

            availableMoves.forEach(move => {
                board[move] = player;
                let score = minimax(board, opponent);
                board[move] = null;

                if (player === 'O' && score > bestScore || player === 'X' && score < bestScore) {
                    bestScore = score;
                    bestMove = move;
                }
            });

            return bestMove;
        }

        // Check for winner (Minimax helper)
        function checkWinner(board, player) {
            const winningCombinations = [
                [0, 1, 2],
                [3, 4, 5],
                [6, 7, 8],
                [0, 3, 6],
                [1, 4, 7],
                [2, 5, 8],
                [0, 4, 8],
                [2, 4, 6],
            ];

            return winningCombinations.some(combo => {
                const [a, b, c] = combo;
                return board[a] === player && board[b] === player && board[c] === player;
            });
        }

        // Find Winning Move (for Blocking or Winning)
        function findWinningMove(player) {
            const winningCombinations = [
                [0, 1, 2],
                [3, 4, 5],
                [6, 7, 8],
                [0, 3, 6],
                [1, 4, 7],
                [2, 5, 8],
                [0, 4, 8],
                [2, 4, 6],
            ];

            for (let combo of winningCombinations) {
                const [a, b, c] = combo;
                if (gameBoard[a] === player && gameBoard[b] === player && gameBoard[c] === null) {
                    return c;
                }
                if (gameBoard[a] === player && gameBoard[c] === player && gameBoard[b] === null) {
                    return b;
                }
                if (gameBoard[b] === player && gameBoard[c] === player && gameBoard[a] === null) {
                    return a;
                }
            }
            return -1;
        }

        // Render the board
        function renderBoard() {
            board.innerHTML = '';
            gameBoard.forEach((cell, index) => {
                const cellElement = document.createElement('div');
                cellElement.classList.add('cell');
                if (cell) {
                    const span = document.createElement('span');
                    span.textContent = cell;
                    span.classList.add('appear');
                    cellElement.appendChild(span);
                }
                cellElement.addEventListener('click', () => handleCellClick(index));
                board.appendChild(cellElement);
            });
            updateScores();
            updateTurnIndicator();
        }

        // Handle cell clicks
        function handleCellClick(index) {
            if (gameBoard[index] !== null || isGameOver || !isPlayerTurn || isGameInProgress) return;
            gameBoard[index] = 'X'; // Player's move
            isPlayerTurn = false;
            isGameInProgress = true; // Block clicks while AI is taking its turn
            renderBoard();
            checkForWinner();
            currentPlayer = 'O';
            aiMove(); // AI's turn after player move
        }

        // Update turn indicator based on current player
        function updateTurnIndicator() {
            if (isGameOver) {
                turnIndicator.textContent = `Game Over!`;
            } else {
                turnIndicator.textContent = `Player ${currentPlayer}'s Turn`;
            }
        }

        // Check for winner or tie
        function checkForWinner() {
            const winningCombinations = [
                [0, 1, 2],
                [3, 4, 5],
                [6, 7, 8],
                [0, 3, 6],
                [1, 4, 7],
                [2, 5, 8],
                [0, 4, 8],
                [2, 4, 6],
            ];

            for (let combo of winningCombinations) {
                const [a, b, c] = combo;
                if (gameBoard[a] && gameBoard[a] === gameBoard[b] && gameBoard[a] === gameBoard[c]) {
                    turnIndicator.textContent = `${gameBoard[a]} wins!`;
                    if (gameBoard[a] === 'X') xScore++;
                    else oScore++;
                    renderBoard();
                    updateScores();
                    showWinnerMessage(`${gameBoard[a]} Wins!`);
                    resetGame();
                    return;
                }
            }

            if (!gameBoard.includes(null)) {
                turnIndicator.textContent = 'It\'s a tie!';
                showWinnerMessage('It\'s a Tie!');
                resetGame();
            }
        }

        // Show the winner message
        function showWinnerMessage(message) {
            winnerMessage.textContent = message;
            winnerMessage.classList.add('appear');
            setTimeout(() => {
                winnerMessage.classList.remove('appear');
            }, 2000); // Fade out after 2 seconds
        }

        // Reset the game
        function resetGame() {
            gameBoard = Array(9).fill(null);
            currentPlayer = 'X'; // Always start with Player X
            isPlayerTurn = true;
            renderBoard();
            updateScores();
            turnIndicator.textContent = `Player ${currentPlayer}'s Turn`;
            isGameOver = false;
            isGameInProgress = false; // Allow clicks again
        }

        // Update scores display
        function updateScores() {
            document.getElementById('x-score').textContent = `X Score: ${xScore}`;
            if (difficulty !== 'coop') {
                document.getElementById('o-score').textContent = `O Score: ${oScore} (${aiDifficulty} AI)`;
            } else {
                document.getElementById('o-score').textContent = `O Score: ${oScore}`;
            }
        }

        // Difficulty change handler
        difficultySelect.addEventListener('change', (event) => {
            difficulty = event.target.value;
            aiDifficulty = difficulty.charAt(0).toUpperCase() + difficulty.slice(1); // Capitalize difficulty
            resetGame();
        });

        renderBoard();
    </script>
</body>
</html>
