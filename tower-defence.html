<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tower Defense</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: #1b2a1d;
            color: white;
        }
        canvas {
            display: block;
            margin: auto;
            background-color: #2d2d2d;
            border: 1px solid white;
        }
        .sidebar {
            position: absolute;
            top: 0;
            right: 0;
            width: 300px;
            height: 100%;
            background-color: #333;
            padding: 10px;
            box-sizing: border-box;
        }
        .turret-info {
            margin-top: 20px;
        }
        .turret-button {
            display: block;
            margin: 10px 0;
            padding: 10px;
            background-color: #004d00;
            border: none;
            color: white;
            font-size: 16px;
            cursor: pointer;
        }
        .turret-button:hover {
            background-color: #66cc66;
        }
        .preview-confirm {
            margin-top: 10px;
            display: none;
            text-align: center;
        }
        .confirm-button {
            padding: 10px 15px;
            background-color: #004d00;
            color: white;
            border: none;
            cursor: pointer;
        }
        .confirm-button:hover {
            background-color: #66cc66;
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas" width="800" height="600"></canvas>
    <div class="sidebar">
        <h3>Turrets</h3>
        <button class="turret-button" data-turret="basic">Basic Turret (Damage: 10, Range: 50) - 50 Gold</button>
        <button class="turret-button" data-turret="sniper">Sniper Turret (Damage: 30, Range: 100) - 150 Gold</button>
        <button class="turret-button" data-turret="cannon">Cannon Turret (Damage: 50, Range: 75) - 300 Gold</button>
        <div class="preview-confirm">
            <p>Confirm turret placement?</p>
            <button class="confirm-button">Confirm</button>
        </div>
        <div class="turret-info">
            <h4>Gold: <span id="goldCount">100</span></h4>
        </div>
    </div>
    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const goldDisplay = document.getElementById('goldCount');
        const previewConfirmDiv = document.querySelector('.preview-confirm');
        const confirmButton = document.querySelector('.confirm-button');

        let gold = 100;
        let enemies = [];
        let turrets = [];
        let previewTurret = null;

        // Path for enemies
        const path = [
            { x: 50, y: 50 }, { x: 50, y: 300 }, { x: 300, y: 300 },
            { x: 300, y: 500 }, { x: 750, y: 500 },
        ];

        // Turret types
        const turretTypes = {
            basic: { cost: 50, damage: 10, range: 50 },
            sniper: { cost: 150, damage: 30, range: 100 },
            cannon: { cost: 300, damage: 50, range: 75 },
        };

        // Enemy configuration
        const enemyTemplate = {
            x: path[0].x,
            y: path[0].y,
            speed: 1,
            health: 50,
        };

        // Update gold display
        function updateGoldDisplay() {
            goldDisplay.textContent = gold;
        }

        // Draw path
        function drawPath() {
            ctx.strokeStyle = 'white';
            ctx.lineWidth = 10;
            ctx.beginPath();
            ctx.moveTo(path[0].x, path[0].y);
            for (const point of path) {
                ctx.lineTo(point.x, point.y);
            }
            ctx.stroke();
        }

        // Draw enemies
        function drawEnemies() {
            ctx.fillStyle = 'red';
            for (const enemy of enemies) {
                ctx.beginPath();
                ctx.arc(enemy.x, enemy.y, 10, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        // Move enemies along the path
        function moveEnemies() {
            for (const enemy of enemies) {
                let target = path[enemy.targetIndex];
                let dx = target.x - enemy.x;
                let dy = target.y - enemy.y;
                let distance = Math.sqrt(dx * dx + dy * dy);

                if (distance < 2) {
                    enemy.targetIndex++;
                    if (enemy.targetIndex >= path.length) {
                        // Enemy reached the end
                        enemies.splice(enemies.indexOf(enemy), 1);
                        continue;
                    }
                } else {
                    enemy.x += (dx / distance) * enemy.speed;
                    enemy.y += (dy / distance) * enemy.speed;
                }
            }
        }

        // Draw turrets
        function drawTurrets() {
            ctx.fillStyle = 'blue';
            for (const turret of turrets) {
                ctx.beginPath();
                ctx.arc(turret.x, turret.y, 10, 0, Math.PI * 2);
                ctx.fill();
                ctx.beginPath();
                ctx.arc(turret.x, turret.y, turret.range, 0, Math.PI * 2);
                ctx.strokeStyle = 'rgba(0, 0, 255, 0.3)';
                ctx.stroke();
            }
        }

        // Turret shooting
        function turretShoot() {
            for (const turret of turrets) {
                for (const enemy of enemies) {
                    let dx = turret.x - enemy.x;
                    let dy = turret.y - enemy.y;
                    let distance = Math.sqrt(dx * dx + dy * dy);

                    if (distance <= turret.range) {
                        enemy.health -= turret.damage;
                        if (enemy.health <= 0) {
                            gold += 10;
                            enemies.splice(enemies.indexOf(enemy), 1);
                        }
                    }
                }
            }
        }

        // Turret preview
        canvas.addEventListener('click', (e) => {
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;

            if (previewTurret) {
                previewTurret.x = x;
                previewTurret.y = y;
                previewConfirmDiv.style.display = 'block';
            }
        });

        // Confirm turret placement
        confirmButton.addEventListener('click', () => {
            if (previewTurret && gold >= turretTypes[previewTurret.type].cost) {
                gold -= turretTypes[previewTurret.type].cost;
                turrets.push(previewTurret);
                previewTurret = null;
                previewConfirmDiv.style.display = 'none';
                updateGoldDisplay();
            }
        });

        // Select turret
        document.querySelectorAll('.turret-button').forEach(button => {
            button.addEventListener('click', () => {
                const turretType = button.dataset.turret;
                if (gold >= turretTypes[turretType].cost) {
                    previewTurret = {
                        ...turretTypes[turretType],
                        type: turretType,
                    };
                }
            });
        });

        // Spawn enemies
        setInterval(() => {
            enemies.push({ ...enemyTemplate, targetIndex: 1 });
        }, 2000);

        // Game loop
        function gameLoop() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawPath();
            drawEnemies();
            drawTurrets();
            moveEnemies();
            turretShoot();
            requestAnimationFrame(gameLoop);
        }

        updateGoldDisplay();
        gameLoop();
    </script>
</body>
</html>
