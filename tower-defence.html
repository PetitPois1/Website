<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tower Defense</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: #1b2a1d;
            color: white;
        }
        canvas {
            display: block;
            margin: auto;
            background-color: #2d2d2d;
            border: 1px solid white;
        }
        .sidebar {
            position: absolute;
            top: 20px;
            left: 20px;
            background-color: rgba(0, 0, 0, 0.7);
            padding: 10px;
            border-radius: 8px;
            color: white;
        }
        .sidebar p {
            margin: 10px 0;
        }
        .button {
            background-color: #66cc66;
            padding: 5px 10px;
            margin: 5px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .button:hover {
            background-color: #55bb55;
        }
    </style>
</head>
<body>
    <div class="sidebar">
        <p>Gold: <span id="goldCount">0</span></p>
        <p>Turret Preview:</p>
        <div id="turretPreview" style="width: 50px; height: 50px; background-color: gray; border-radius: 50%;"></div>
        <p>Damage Per Second (DPS): <span id="turretDPS">0</span></p>
        <p>Range: <span id="turretRange">0</span></p>
        <button class="button" id="placeTurret">Place Turret</button>
    </div>
    <canvas id="gameCanvas"></canvas>

    <script>
        const canvas = document.getElementById("gameCanvas");
        const ctx = canvas.getContext("2d");

        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        // Game variables
        let gold = 0;
        let turrets = [];
        let enemies = [];
        let path = [
            {x: 0, y: 100},
            {x: canvas.width / 4, y: 100},
            {x: canvas.width / 4, y: canvas.height / 2},
            {x: canvas.width / 2, y: canvas.height / 2},
            {x: canvas.width / 2, y: canvas.height - 100}
        ];

        // Turret class
        class Turret {
            constructor(x, y, damage, range) {
                this.x = x;
                this.y = y;
                this.damage = damage;
                this.range = range;
                this.dps = damage; // Turret's damage per second
                this.target = null;
            }

            draw() {
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.range, 0, 2 * Math.PI);
                ctx.strokeStyle = 'rgba(255, 255, 255, 0.5)';
                ctx.stroke();
                ctx.fillStyle = 'green';
                ctx.fill();
            }

            findTarget() {
                for (let enemy of enemies) {
                    const distance = Math.hypot(this.x - enemy.x, this.y - enemy.y);
                    if (distance <= this.range && !enemy.dead) {
                        this.target = enemy;
                        break;
                    }
                }
            }

            attack() {
                if (this.target) {
                    this.target.health -= this.dps / 60;  // Attack once per frame, scaled by FPS (60)
                    if (this.target.health <= 0) {
                        this.target.dead = true;
                        gold += 10; // Reward gold on death
                    }
                }
            }
        }

        // Enemy class
        class Enemy {
            constructor(path) {
                this.x = path[0].x;
                this.y = path[0].y;
                this.path = path;
                this.index = 0;
                this.speed = 2; // Speed of enemy movement
                this.health = 100;
                this.dead = false;
            }

            move() {
                if (this.index < this.path.length - 1) {
                    const target = this.path[this.index + 1];
                    const angle = Math.atan2(target.y - this.y, target.x - this.x);
                    this.x += Math.cos(angle) * this.speed;
                    this.y += Math.sin(angle) * this.speed;

                    // Check if reached next path point
                    const distance = Math.hypot(this.x - target.x, this.y - target.y);
                    if (distance < 5) {
                        this.index++;
                    }
                }
            }

            draw() {
                ctx.beginPath();
                ctx.arc(this.x, this.y, 10, 0, 2 * Math.PI);
                ctx.fillStyle = 'red';
                ctx.fill();
            }
        }

        // Function to update the game state
        function update() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Draw path
            ctx.beginPath();
            ctx.moveTo(path[0].x, path[0].y);
            for (let point of path) {
                ctx.lineTo(point.x, point.y);
            }
            ctx.strokeStyle = "white";
            ctx.stroke();

            // Update and draw turrets
            for (let turret of turrets) {
                turret.findTarget();
                turret.attack();
                turret.draw();
            }

            // Update and draw enemies
            for (let enemy of enemies) {
                if (!enemy.dead) {
                    enemy.move();
                    enemy.draw();
                }
            }

            // Draw preview turret
            const turretPreview = document.getElementById("turretPreview");
            const turretDPS = document.getElementById("turretDPS");
            const turretRange = document.getElementById("turretRange");

            if (previewTurret) {
                turretPreview.style.left = `${previewTurret.x - 25}px`;
                turretPreview.style.top = `${previewTurret.y - 25}px`;
                turretDPS.textContent = previewTurret.dps;
                turretRange.textContent = previewTurret.range;
            }

            // Update gold
            document.getElementById("goldCount").textContent = gold;

            requestAnimationFrame(update);
        }

        // Turret preview and placement
        let previewTurret = null;
        canvas.addEventListener("click", (e) => {
            if (!previewTurret) {
                previewTurret = new Turret(e.clientX, e.clientY, 10, 100); // Sample turret with 10 DPS and 100 range
            }
        });

        document.getElementById("placeTurret").addEventListener("click", () => {
            if (previewTurret) {
                turrets.push(previewTurret);
                previewTurret = null; // Clear preview after placing
            }
        });

        // Create enemies periodically
        setInterval(() => {
            enemies.push(new Enemy(path));
        }, 2000);

        // Start the game loop
        update();
    </script>
</body>
</html>
