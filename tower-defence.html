<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tower Defense</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: #1b2a1d;
            color: white;
        }
        canvas {
            display: block;
            margin: auto;
            background-color: #2d2d2d;
            border: 1px solid white;
        }
        .sidebar {
            position: absolute;
            top: 20px;
            left: 20px;
            background-color: rgba(0, 0, 0, 0.7);
            padding: 10px;
            border-radius: 8px;
            color: white;
        }
        .sidebar p {
            margin: 10px 0;
        }
        .button {
            background-color: #66cc66;
            padding: 5px 10px;
            margin: 5px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .button:hover {
            background-color: #55bb55;
        }
    </style>
</head>
<body>
    <div class="sidebar">
        <p>Gold: <span id="goldCount">0</span></p>
        <p>Turret Stats:</p>
        <p id="turretInfo">Select a turret to place.</p>
        <button id="confirmButton" class="button" style="display:none;">Confirm Placement</button>
    </div>

    <canvas id="gameCanvas" width="800" height="600"></canvas>

    <script>
        const canvas = document.getElementById("gameCanvas");
        const ctx = canvas.getContext("2d");
        const goldDisplay = document.getElementById("goldCount");
        const turretInfo = document.getElementById("turretInfo");
        const confirmButton = document.getElementById("confirmButton");
        const gridSize = 40; // Size of each cell in the grid
        let gold = 100;
        let turrets = [];
        let enemies = [];
        let turretPreview = null; // Preview turret before placement

        // Turret details (damage per second and range)
        const turretsData = {
            "basic": { damagePerSec: 10, range: 100, cost: 50 },
            "advanced": { damagePerSec: 20, range: 150, cost: 100 },
            "elite": { damagePerSec: 30, range: 200, cost: 200 },
        };
        let selectedTurret = null;

        // Enemy class
        class Enemy {
            constructor(x, y, health, speed) {
                this.x = x;
                this.y = y;
                this.health = health;
                this.speed = speed;
                this.pathIndex = 0;
            }

            move() {
                const path = [
                    { x: 0, y: 300 },
                    { x: 400, y: 300 },
                    { x: 400, y: 100 },
                    { x: 800, y: 100 },
                ];

                const target = path[this.pathIndex];

                if (target) {
                    const dx = target.x - this.x;
                    const dy = target.y - this.y;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    const moveX = (dx / distance) * this.speed;
                    const moveY = (dy / distance) * this.speed;

                    this.x += moveX;
                    this.y += moveY;

                    if (distance < this.speed) {
                        this.pathIndex++;
                    }
                }
            }
        }

        // Turret class
        class Turret {
            constructor(x, y, damagePerSec, range) {
                this.x = x;
                this.y = y;
                this.damagePerSec = damagePerSec;
                this.range = range;
                this.lastAttackTime = 0;
            }

            draw() {
                ctx.beginPath();
                ctx.arc(this.x, this.y, 10, 0, Math.PI * 2);
                ctx.fillStyle = "red";
                ctx.fill();

                // Draw range circle
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.range, 0, Math.PI * 2);
                ctx.strokeStyle = "rgba(255, 0, 0, 0.5)";
                ctx.lineWidth = 2;
                ctx.stroke();
            }

            attack(enemy, currentTime) {
                const dx = enemy.x - this.x;
                const dy = enemy.y - this.y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                if (distance <= this.range && currentTime - this.lastAttackTime >= 1000) { // Attack every second
                    enemy.health -= this.damagePerSec;
                    this.lastAttackTime = currentTime;
                }
            }
        }

        // Set up the game
        function init() {
            generateEnemies();
            render();
        }

        function generateEnemies() {
            enemies.push(new Enemy(0, 300, 100, 1));
        }

        function render() {
            const currentTime = Date.now();

            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Draw enemies
            for (const enemy of enemies) {
                enemy.move();
                ctx.beginPath();
                ctx.arc(enemy.x, enemy.y, 10, 0, Math.PI * 2);
                ctx.fillStyle = "blue";
                ctx.fill();
            }

            // Draw turrets
            for (const turret of turrets) {
                turret.draw();
            }

            // Draw turret preview
            if (turretPreview) {
                ctx.beginPath();
                ctx.arc(turretPreview.x, turretPreview.y, 10, 0, Math.PI * 2);
                ctx.fillStyle = "yellow";
                ctx.fill();
                ctx.beginPath();
                ctx.arc(turretPreview.x, turretPreview.y, turretPreview.range, 0, Math.PI * 2);
                ctx.strokeStyle = "rgba(255, 255, 0, 0.5)";
                ctx.lineWidth = 2;
                ctx.stroke();
            }

            // Check for turret attacks
            for (const turret of turrets) {
                for (const enemy of enemies) {
                    turret.attack(enemy, currentTime);
                    if (enemy.health <= 0) {
                        gold += 10; // Increase gold on enemy death
                        goldDisplay.innerText = gold;
                    }
                }
            }

            requestAnimationFrame(render);
        }

        // Handle click for placing turret
        canvas.addEventListener("click", (e) => {
            if (selectedTurret && gold >= selectedTurret.cost) {
                const x = Math.floor(e.offsetX / gridSize) * gridSize;
                const y = Math.floor(e.offsetY / gridSize) * gridSize;
                if (turretPreview) {
                    turrets.push(new Turret(x, y, selectedTurret.damagePerSec, selectedTurret.range));
                    gold -= selectedTurret.cost;
                    goldDisplay.innerText = gold;
                    turretPreview = null; // Clear preview
                }
            }
        });

        // Handle turret selection and preview
        function setTurret(type) {
            selectedTurret = turretsData[type];
            turretInfo.innerText = `Damage: ${selectedTurret.damagePerSec} /sec, Range: ${selectedTurret.range}, Cost: ${selectedTurret.cost}`;
            confirmButton.style.display = "block";
            // Show preview when mouse clicks
            canvas.addEventListener("mousemove", (e) => {
                if (selectedTurret) {
                    turretPreview = { 
                        x: Math.floor(e.offsetX / gridSize) * gridSize, 
                        y: Math.floor(e.offsetY / gridSize) * gridSize, 
                        range: selectedTurret.range 
                    };
                }
            });

            confirmButton.onclick = () => {
                turretPreview = null; // Confirm placement, hide preview
            };
        }

        // Set a turret from the selection (use "basic", "advanced", or "elite")
        setTurret("basic"); // For example, select the "basic" turret

        init();
    </script>
</body>
</html>
