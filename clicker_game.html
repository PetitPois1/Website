<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Industrial Clicker: Evolution</title>
    <style>
        :root {
            --primary: #66cc66;
            --bg-dark: #1b2a1d;
            --panel-bg: rgba(0, 0, 0, 0.4);
            --border: #2d4a30;
            --save-color: #44aaff;
        }

        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0;
            padding: 20px;
            background-color: var(--bg-dark);
            font-family: 'Segoe UI', sans-serif;
            color: white;
            overflow-x: hidden;
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
            background: var(--panel-bg);
            padding: 20px;
            border-radius: 12px;
            width: 90%;
            max-width: 600px;
            border: 1px solid var(--border);
            position: sticky;
            top: 10px;
            z-index: 1000;
            backdrop-filter: blur(5px);
        }

        .credit-display { font-size: 2.5rem; font-weight: bold; color: white; margin: 0; }
        .production-display { color: var(--primary); font-size: 1.1rem; margin-top: 5px; }

        .buy-modes {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .mode-btn {
            background: #222;
            border: 1px solid var(--primary);
            color: var(--primary);
            padding: 8px 15px;
            cursor: pointer;
            border-radius: 4px;
            font-weight: bold;
        }

        .mode-btn.active { background: var(--primary); color: black; }

        .click-area {
            height: 220px;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 20px;
        }

        #circle {
            width: 160px;
            height: 160px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            cursor: pointer;
            user-select: none;
            transition: all 0.2s ease;
            text-align: center;
            padding: 10px;
            box-shadow: 0 0 20px rgba(102, 204, 102, 0.1);
        }

        #circle:active { transform: scale(0.92); }

        /* Tier Shapes */
        .tier-0 { border-radius: 50%; background: #553311; border: 4px solid #885522; }
        .tier-1 { border-radius: 50%; background: #b87333; border: 4px solid #e39a5d; }
        .tier-2 { border-radius: 15%; background: #a19d94; border: 4px solid #ced4da; }
        .tier-3 { border-radius: 5px;  background: #4682b4; border: 4px solid #87ceeb; }
        .tier-4 { clip-path: polygon(50% 0%, 100% 38%, 82% 100%, 18% 100%, 0% 38%); background: #ffd700; border: none; }
        .tier-5 { clip-path: polygon(50% 0%, 100% 50%, 50% 100%, 0% 50%); background: #00f2ff; border: none; box-shadow: 0 0 30px #00f2ff; }

        .shop { width: 100%; max-width: 750px; }
        .section-title { color: var(--primary); border-bottom: 1px solid var(--border); margin: 20px 0 10px; padding-bottom: 5px; }

        .upgrade-card {
            background: var(--panel-bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 12px;
            display: grid;
            grid-template-columns: 1fr auto;
            align-items: center;
            gap: 15px;
        }

        .upgrade-info h3 { margin: 0; color: var(--primary); font-size: 1.1rem; }
        .upgrade-info p { margin: 5px 0; font-size: 0.8rem; color: #aaa; }
        .upgrade-stats { font-size: 0.85rem; color: var(--primary); font-weight: bold; display: flex; flex-direction: column; gap: 2px; }
        .total-yield { color: #aaa; font-weight: normal; font-size: 0.75rem; }

        .buy-btn {
            background: #004d00;
            color: white;
            border: 1px solid var(--primary);
            padding: 10px;
            border-radius: 6px;
            cursor: pointer;
            min-width: 150px;
            font-weight: bold;
            text-align: center;
        }

        .buy-btn.disabled { opacity: 0.3; cursor: not-allowed; background: #222; }

        /* Pop-up Notification Styling */
        #save-toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--save-color);
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            z-index: 2000;
        }
        #save-toast.show { transform: translateY(0); opacity: 1; }

        .controls {
            display: flex;
            gap: 15px;
            margin: 40px 0;
        }

        .save-btn { color: var(--save-color); background: none; border: 1px solid var(--save-color); cursor: pointer; padding: 8px 15px; border-radius: 4px; font-weight: bold; }
        .save-btn:hover { background: var(--save-color); color: white; }
        .reset-btn { color: #ff5555; background: none; border: 1px solid #ff5555; cursor: pointer; padding: 8px 15px; border-radius: 4px; }

        .floating-text {
            position: absolute;
            color: var(--primary);
            font-weight: bold;
            pointer-events: none;
            animation: floatUp 0.7s ease-out forwards;
            z-index: 100;
        }
        @keyframes floatUp { 0% { transform: translateY(0); opacity: 1; } 100% { transform: translateY(-80px); opacity: 0; } }
    </style>
</head>
<body>

    <div id="save-toast">Game Saved!</div>

    <div class="header">
        <div class="credit-display" id="creditCount">0 Credits</div>
        <div class="production-display">Total Production: <span id="cpsCount">0</span>/sec</div>
    </div>

    <div class="buy-modes">
        <button id="mode-1" class="mode-btn active" onclick="setBuyMode(1)">x1</button>
        <button id="mode-10" class="mode-btn" onclick="setBuyMode(10)">x10</button>
        <button id="mode-100" class="mode-btn" onclick="setBuyMode(100)">x100</button>
        <button id="mode-max" class="mode-btn" onclick="setBuyMode('max')">MAX</button>
    </div>

    <div class="click-area">
        <div id="circle" class="tier-0">START</div>
    </div>

    <div class="shop">
        <h2 class="section-title">Technology Tiers</h2>
        <div id="tier-container"></div>

        <h2 class="section-title">Factory Machines</h2>
        <div id="machine-container"></div>
    </div>

    <div class="controls">
        <button class="save-btn" onclick="manualSave()">Save Factory</button>
        <button class="reset-btn" onclick="resetGame()">Full Reset</button>
    </div>

    <script>
        let credits = 0;
        let buyMode = 1;
        let currentTier = 0;
        const growthRate = 1.15;

        const tierUpgrades = [
            { name: "Copper Age", cost: 50, clickBoost: 5, label: "COPPER", class: "tier-1", desc: "Unlock copper tools." },
            { name: "Iron Age", cost: 500, clickBoost: 25, label: "IRON", class: "tier-2", desc: "Heavier, stronger material." },
            { name: "Steel Age", cost: 5000, clickBoost: 150, label: "STEEL", class: "tier-3", desc: "Industrial grade durability." },
            { name: "Electronics", cost: 50000, clickBoost: 1000, label: "GOLD", class: "tier-4", desc: "Precision digital components." },
            { name: "Computing", cost: 500000, clickBoost: 10000, label: "DATA", class: "tier-5", desc: "The ultimate processing power." }
        ];

        const machineUpgrades = {
            small: { name: "Small Machine", desc: "A basic automated unit.", baseCost: 15, addAuto: 1 },
            big: { name: "Large Machine", desc: "Greater capacity, higher yield.", baseCost: 150, addAuto: 8 },
            line: { name: "Assembly Line", desc: "Optimized for speed.", baseCost: 1200, addAuto: 45 },
            factory: { name: "Grand Factory", desc: "Massive industrial complex.", baseCost: 15000, addAuto: 250 },
            hub: { name: "Digital Hub", desc: "The center of all production.", baseCost: 200000, addAuto: 2000 }
        };

        let inventory = {};
        Object.keys(machineUpgrades).forEach(id => inventory[id] = 0);

        function setBuyMode(mode) {
            buyMode = mode;
            document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`mode-${mode}`).classList.add('active');
            updateUI();
        }

        function getCostOfMany(id, amount) {
            let n = inventory[id];
            let b = machineUpgrades[id].baseCost;
            let r = growthRate;
            if (amount === 'max') {
                amount = Math.floor(Math.log(((credits * (r - 1)) / (b * Math.pow(r, n))) + 1) / Math.log(r));
                amount = Math.max(0, amount);
                if (amount === 0) return { cost: b * Math.pow(r, n), count: 1 };
            }
            let totalCost = b * (Math.pow(r, n) * (Math.pow(r, amount) - 1)) / (r - 1);
            return { cost: totalCost, count: amount };
        }

        function updateUI() {
            document.getElementById('creditCount').innerText = `${Math.floor(credits).toLocaleString()} Credits`;
            
            let totalCps = 0;
            Object.keys(machineUpgrades).forEach(id => totalCps += machineUpgrades[id].addAuto * inventory[id]);
            document.getElementById('cpsCount').innerText = totalCps.toLocaleString();
            window.currentCps = totalCps;

            let totalClick = 1;
            for(let i=0; i < currentTier; i++) { totalClick += tierUpgrades[i].clickBoost; }
            window.currentClickValue = totalClick;

            Object.keys(machineUpgrades).forEach(id => {
                const buyData = getCostOfMany(id, buyMode);
                const btn = document.getElementById(`btn-${id}`);
                const yieldPerUnit = machineUpgrades[id].addAuto;
                const totalMachineYield = yieldPerUnit * inventory[id];

                btn.innerHTML = `Buy ${buyData.count}<br>${Math.round(buyData.cost).toLocaleString()} C`;
                btn.className = (credits >= buyData.cost && buyData.count > 0) ? "buy-btn" : "buy-btn disabled";
                btn.onclick = () => buyMachine(id, buyData.count, buyData.cost);
                
                document.getElementById(`count-${id}`).innerHTML = `
                    <span>Owned: ${inventory[id].toLocaleString()} (+${yieldPerUnit}/sec)</span>
                    <span class="total-yield">Combined Production: ${totalMachineYield.toLocaleString()}/sec</span>
                `;
            });

            const tierBox = document.getElementById('tier-container');
            if (currentTier < tierUpgrades.length) {
                const next = tierUpgrades[currentTier];
                tierBox.innerHTML = `
                    <div class="upgrade-card">
                        <div class="upgrade-info">
                            <h3>Next Tier: ${next.name}</h3>
                            <p>${next.desc}</p>
                            <div class="upgrade-stats">+${next.clickBoost.toLocaleString()} Click Power</div>
                        </div>
                        <button class="buy-btn ${credits < next.cost ? 'disabled' : ''}" onclick="evolveTier()">
                            Evolve Shape<br>${next.cost.toLocaleString()} C
                        </button>
                    </div>`;
            } else {
                tierBox.innerHTML = `<p style="text-align:center; color:#66cc66; font-weight:bold;">MAX TECHNOLOGY ACHIEVED</p>`;
            }
        }

        function buyMachine(id, count, cost) {
            if (credits >= cost && count > 0) {
                credits -= cost;
                inventory[id] += count;
                updateUI();
            }
        }

        function evolveTier() {
            const next = tierUpgrades[currentTier];
            if (credits >= next.cost) {
                credits -= next.cost;
                const circle = document.getElementById('circle');
                circle.className = next.class;
                circle.innerText = next.label;
                currentTier++;
                updateUI();
                saveGame(true); // Explicit save with toast
            }
        }

        // --- SAVE SYSTEM ---

        function showSavePopUp() {
            const toast = document.getElementById('save-toast');
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 2000);
        }

        function saveGame(showToast = false) {
            const data = { credits, inventory, currentTier };
            localStorage.setItem("IndusClick_V9", JSON.stringify(data));
            if(showToast) showSavePopUp();
        }

        function manualSave() {
            saveGame(true);
        }

        function loadGame() {
            const data = JSON.parse(localStorage.getItem("IndusClick_V9"));
            if(data) {
                credits = data.credits;
                inventory = data.inventory || inventory;
                currentTier = data.currentTier || 0;
                if(currentTier > 0) {
                    const circle = document.getElementById('circle');
                    circle.className = tierUpgrades[currentTier-1].class;
                    circle.innerText = tierUpgrades[currentTier-1].label;
                }
            }
            updateUI();
        }

        function resetGame() {
            if(confirm("Confirm Factory Wipe? All Tiers and Machines will be lost!")) { 
                localStorage.removeItem("IndusClick_V9"); 
                location.reload(); 
            }
        }

        // --- INIT ---

        const machineBox = document.getElementById('machine-container');
        Object.keys(machineUpgrades).forEach(id => {
            machineBox.innerHTML += `
                <div class="upgrade-card">
                    <div class="upgrade-info">
                        <h3>${machineUpgrades[id].name}</h3>
                        <p>${machineUpgrades[id].desc}</p>
                        <div class="upgrade-stats" id="count-${id}"></div>
                    </div>
                    <button class="buy-btn" id="btn-${id}"></button>
                </div>`;
        });

        document.getElementById('circle').addEventListener('click', (e) => {
            credits += window.currentClickValue;
            showFloat(e);
            updateUI();
        });

        function showFloat(e) {
            const txt = document.createElement('div');
            txt.className = 'floating-text';
            txt.innerText = `+${window.currentClickValue}`;
            txt.style.left = e.clientX + 'px'; txt.style.top = e.clientY + 'px';
            document.body.appendChild(txt);
            setTimeout(() => txt.remove(), 700);
        }

        setInterval(() => { 
            if(window.currentCps > 0) { 
                credits += (window.currentCps / 10); 
                updateUI(); 
            } 
        }, 100);

        // Auto-save every 15 seconds with notification
        setInterval(() => saveGame(true), 15000);

        loadGame();
    </script>
</body>
</html>
