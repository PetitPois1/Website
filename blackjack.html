<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tower Defense</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: #1b2a1d;
            color: white;
        }
        canvas {
            display: block;
            margin: auto;
            background-color: #2d2d2d;
            border: 1px solid white;
        }
        .sidebar {
            position: absolute;
            top: 20px;
            right: 20px;
            background-color: rgba(0, 0, 0, 0.7);
            padding: 10px;
            border-radius: 8px;
            color: white;
        }
        .sidebar p {
            margin: 10px 0;
        }
        .button {
            background-color: #66cc66;
            padding: 5px 10px;
            margin: 5px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .button:hover {
            background-color: #55bb55;
        }
    </style>
</head>
<body>
    <div class="sidebar">
        <p>Gold: <span id="goldCount">100</span></p>
        <p>Turret Stats:</p>
        <p id="turretInfo">Select a turret to place.</p>
        <button id="confirmButton" class="button" style="display:none;">Confirm Placement</button>
    </div>

    <canvas id="gameCanvas" width="800" height="600"></canvas>

    <script>
        const canvas = document.getElementById("gameCanvas");
        const ctx = canvas.getContext("2d");
        const goldDisplay = document.getElementById("goldCount");
        const turretInfo = document.getElementById("turretInfo");
        const confirmButton = document.getElementById("confirmButton");
        const gridSize = 40;
        let gold = 100;
        let turrets = [];
        let enemies = [];
        let path = [
            { x: 100, y: 550 },
            { x: 100, y: 300 },
            { x: 400, y: 300 },
            { x: 400, y: 100 },
            { x: 750, y: 100 },
        ];
        let turretPreview = null;
        let selectedTurret = null;
        let canPlaceTurret = false;

        // Turret and enemy data
        const turretsData = {
            "basic": { damage: 5, range: 100, cost: 50 },
            "advanced": { damage: 10, range: 150, cost: 100 },
        };

        class Enemy {
            constructor(x, y, health, speed) {
                this.x = x;
                this.y = y;
                this.health = health;
                this.speed = speed;
                this.pathIndex = 0;
            }

            move() {
                if (this.pathIndex < path.length - 1) {
                    const target = path[this.pathIndex + 1];
                    const dx = target.x - this.x;
                    const dy = target.y - this.y;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    const moveX = (dx / distance) * this.speed;
                    const moveY = (dy / distance) * this.speed;

                    this.x += moveX;
                    this.y += moveY;

                    if (distance < this.speed) {
                        this.pathIndex++;
                    }
                }
            }

            draw() {
                ctx.beginPath();
                ctx.arc(this.x, this.y, 10, 0, Math.PI * 2);
                ctx.fillStyle = "blue";
                ctx.fill();

                // Draw health bar
                ctx.fillStyle = "red";
                ctx.fillRect(this.x - 15, this.y - 20, 30, 5);
                ctx.fillStyle = "green";
                ctx.fillRect(this.x - 15, this.y - 20, (30 * this.health) / 100, 5);
            }
        }

        class Turret {
            constructor(x, y, damage, range) {
                this.x = x;
                this.y = y;
                this.damage = damage;
                this.range = range;
                this.target = null;
            }

            draw() {
                ctx.beginPath();
                ctx.arc(this.x, this.y, 10, 0, Math.PI * 2);
                ctx.fillStyle = "red";
                ctx.fill();

                // Draw range circle
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.range, 0, Math.PI * 2);
                ctx.strokeStyle = "rgba(255, 0, 0, 0.5)";
                ctx.lineWidth = 2;
                ctx.stroke();
            }

            attack(enemies) {
                if (!this.target || this.target.health <= 0 || !this.isInRange(this.target)) {
                    this.target = this.findTarget(enemies);
                }
                if (this.target) {
                    this.target.health -= this.damage;
                }
            }

            findTarget(enemies) {
                for (const enemy of enemies) {
                    if (this.isInRange(enemy)) {
                        return enemy;
                    }
                }
                return null;
            }

            isInRange(enemy) {
                const dx = enemy.x - this.x;
                const dy = enemy.y - this.y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                return distance <= this.range;
            }
        }

        function spawnEnemy() {
            enemies.push(new Enemy(path[0].x, path[0].y, 100, 1));
        }

        function setTurret(type) {
            selectedTurret = turretsData[type];
            turretInfo.innerText = `Damage: ${selectedTurret.damage}, Range: ${selectedTurret.range}, Cost: ${selectedTurret.cost}`;
            confirmButton.style.display = "block";
            canPlaceTurret = true;
        }

        canvas.addEventListener("mousemove", (e) => {
            if (canPlaceTurret) {
                const x = Math.floor(e.offsetX / gridSize) * gridSize + gridSize / 2;
                const y = Math.floor(e.offsetY / gridSize) * gridSize + gridSize / 2;
                turretPreview = { x, y, range: selectedTurret.range };
            }
        });

        confirmButton.addEventListener("click", () => {
            if (canPlaceTurret && turretPreview && gold >= selectedTurret.cost) {
                const newTurret = new Turret(turretPreview.x, turretPreview.y, selectedTurret.damage, selectedTurret.range);
                turrets.push(newTurret);
                gold -= selectedTurret.cost;
                goldDisplay.innerText = gold;
                confirmButton.style.display = "none";
                canPlaceTurret = false;
                turretPreview = null;
            } else {
                alert("Not enough gold!");
            }
        });

        function render() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Draw the path
            ctx.beginPath();
            ctx.moveTo(path[0].x, path[0].y);
            for (let i = 1; i < path.length; i++) {
                ctx.lineTo(path[i].x, path[i].y);
            }
            ctx.lineWidth = 8;
            ctx.strokeStyle = "white";
            ctx.stroke();

            // Draw and move enemies
            for (let i = enemies.length - 1; i >= 0; i--) {
                const enemy = enemies[i];
                enemy.move();
                enemy.draw();

                if (enemy.health <= 0 || enemy.pathIndex >= path.length - 1) {
                    enemies.splice(i, 1);
                    if (enemy.health <= 0) gold += 10; // Add gold if killed
                }
            }

            // Draw and activate turrets
            for (const turret of turrets) {
                turret.draw();
                turret.attack(enemies);
            }

            // Draw turret preview
            if (turretPreview) {
                ctx.beginPath();
                ctx.arc(turretPreview.x, turretPreview.y, 10, 0, Math.PI * 2);
                ctx.fillStyle = "yellow";
                ctx.fill();
                ctx.beginPath();
                ctx.arc(turretPreview.x, turretPreview.y, turretPreview.range, 0, Math.PI * 2);
                ctx.strokeStyle = "rgba(255, 255, 0, 0.5)";
                ctx.lineWidth = 2;
                ctx.stroke();
            }

            goldDisplay.innerText = gold;
            requestAnimationFrame(render);
        }

        function init() {
            setInterval(spawnEnemy, 2000);
            render();
        }

        init();
    </script>
</body>
</html>
